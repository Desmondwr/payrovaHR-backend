# Generated by Django 5.2.9 on 2026-01-11 21:19

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('employees', '0007_alter_employeedocument_document_type'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ContractTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('employer_id', models.IntegerField(db_index=True, help_text='ID of the employer (from main database)')),
                ('name', models.CharField(help_text='Name of the template', max_length=255)),
                ('contract_type', models.CharField(choices=[('PERMANENT', 'Permanent'), ('FIXED_TERM', 'Fixed-Term'), ('INTERNSHIP', 'Internship'), ('CONSULTANT', 'Consultant'), ('PART_TIME', 'Part-Time')], help_text='Type of contract this template applies to', max_length=20)),
                ('file', models.FileField(help_text='Template file (DOCX, PDF, etc.)', upload_to='contract_templates/')),
                ('body_override', models.TextField(blank=True, null=True)),
                ('is_default', models.BooleanField(default=False, help_text='Use as default template for this contract type')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Contract Template',
                'verbose_name_plural': 'Contract Templates',
                'db_table': 'contract_templates',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Contract',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True, help_text='ID of the employer (from main database)')),
                ('contract_id', models.CharField(help_text='Unique contract identifier (auto-generated or manual)', max_length=50, unique=True)),
                ('contract_type', models.CharField(choices=[('PERMANENT', 'Permanent'), ('FIXED_TERM', 'Fixed-Term'), ('INTERNSHIP', 'Internship'), ('CONSULTANT', 'Consultant'), ('PART_TIME', 'Part-Time')], help_text='Type of employment contract', max_length=20)),
                ('start_date', models.DateField(help_text='Contract start date')),
                ('end_date', models.DateField(blank=True, help_text='Contract end date (nullable for permanent contracts)', null=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING_APPROVAL', 'Pending Approval'), ('APPROVED', 'Approved'), ('PENDING_SIGNATURE', 'Pending Signature'), ('SIGNED', 'Signed'), ('ACTIVE', 'Active'), ('EXPIRED', 'Expired'), ('TERMINATED', 'Terminated'), ('CANCELLED', 'Cancelled')], default='DRAFT', help_text='Current status of the contract', max_length=20)),
                ('base_salary', models.DecimalField(decimal_places=2, help_text='Base salary amount', max_digits=12)),
                ('currency', models.CharField(default='XAF', help_text='Currency code (e.g., XAF, USD, EUR)', max_length=3)),
                ('pay_frequency', models.CharField(choices=[('MONTHLY', 'Monthly'), ('BI_WEEKLY', 'Bi-Weekly'), ('WEEKLY', 'Weekly'), ('DAILY', 'Daily')], default='MONTHLY', help_text='Payment frequency', max_length=20)),
                ('termination_date', models.DateField(blank=True, help_text='Date when the contract was terminated', null=True)),
                ('termination_reason', models.TextField(blank=True, help_text='Reason for termination', null=True)),
                ('notice_served', models.BooleanField(default=False, help_text='Whether the required notice period was served')),
                ('final_pay_flag', models.BooleanField(default=False, help_text='Flag to trigger final payroll calculation')),
                ('created_by', models.IntegerField(db_index=True, help_text='ID of the user who created this contract (from main database)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('branch', models.ForeignKey(blank=True, help_text='Branch where employee works', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contracts', to='employees.branch')),
                ('department', models.ForeignKey(blank=True, help_text='Department where employee works', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contracts', to='employees.department')),
                ('employee', models.ForeignKey(help_text='Employee this contract belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='contracts', to='employees.employee')),
                ('previous_contract', models.ForeignKey(blank=True, help_text='Previous contract if this is a renewal', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='renewals', to='contracts.contract')),
            ],
            options={
                'verbose_name': 'Contract',
                'verbose_name_plural': 'Contracts',
                'db_table': 'contracts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Allowance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Name of the allowance/deduction', max_length=255)),
                ('type', models.CharField(choices=[('FIXED', 'Fixed Amount'), ('PERCENTAGE', 'Percentage of Base Salary')], default='FIXED', help_text='Type of calculation', max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Amount value (currency or percentage)', max_digits=12)),
                ('taxable', models.BooleanField(default=True, help_text='Is this component taxable?')),
                ('cnps_base', models.BooleanField(default=True, help_text='Is this component part of CNPS base?')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('allowance_id', models.IntegerField(blank=True, help_text='Optional reference to an allowance template or master list', null=True)),
                ('effective_from', models.DateField(blank=True, help_text='Date when this allowance takes effect', null=True)),
                ('contract', models.ForeignKey(help_text='Contract this component belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='%(class)ss', to='contracts.contract')),
            ],
            options={
                'verbose_name': 'Allowance',
                'verbose_name_plural': 'Allowances',
                'db_table': 'contract_allowances',
                'ordering': ['name'],
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ContractAudit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(max_length=50)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='JSON metadata for the action', null=True)),
                ('details', models.TextField(blank=True, null=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='contracts.contract')),
                ('performed_by', models.ForeignKey(blank=True, db_constraint=False, help_text='User who performed the action', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'contract_audits',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='ContractDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Display name of the document', max_length=255)),
                ('file', models.FileField(help_text='The generated document file', upload_to='contract_documents/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('contract', models.ForeignKey(help_text='Contract this document belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='contracts.contract')),
                ('generated_from', models.ForeignKey(blank=True, help_text='Template used to generate this document', null=True, on_delete=django.db.models.deletion.SET_NULL, to='contracts.contracttemplate')),
            ],
            options={
                'verbose_name': 'Contract Document',
                'verbose_name_plural': 'Contract Documents',
                'db_table': 'contract_documents',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ContractSignature',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('signer_name', models.CharField(help_text='Typed name of the signer', max_length=255)),
                ('role', models.CharField(choices=[('EMPLOYEE', 'Employee'), ('EMPLOYER', 'Employer')], max_length=20)),
                ('signature_text', models.CharField(help_text='Text or representation of signature', max_length=255)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('signature_method', models.CharField(blank=True, choices=[('DOCUSIGN', 'DocuSign'), ('INTERNAL', 'Internal')], help_text='Method used to obtain this signature', max_length=20, null=True)),
                ('signature_audit_id', models.CharField(blank=True, help_text='Optional audit trail reference', max_length=255, null=True)),
                ('document_hash', models.CharField(help_text='SHA256 hash of the document signed', max_length=64)),
                ('signed_at', models.DateTimeField(auto_now_add=True)),
                ('contract', models.ForeignKey(help_text='Contract being signed', on_delete=django.db.models.deletion.CASCADE, related_name='signatures', to='contracts.contract')),
                ('signed_document', models.ForeignKey(blank=True, help_text='Document that was signed', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='signatures', to='contracts.contractdocument')),
                ('signer_user', models.ForeignKey(blank=True, db_constraint=False, help_text='User who signed (optional for magic links)', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contract Signature',
                'verbose_name_plural': 'Contract Signatures',
                'db_table': 'contract_signatures',
                'ordering': ['signed_at'],
            },
        ),
        migrations.CreateModel(
            name='Deduction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Name of the allowance/deduction', max_length=255)),
                ('type', models.CharField(choices=[('FIXED', 'Fixed Amount'), ('PERCENTAGE', 'Percentage of Base Salary')], default='FIXED', help_text='Type of calculation', max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Amount value (currency or percentage)', max_digits=12)),
                ('taxable', models.BooleanField(default=True, help_text='Is this component taxable?')),
                ('cnps_base', models.BooleanField(default=True, help_text='Is this component part of CNPS base?')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deduction_id', models.IntegerField(blank=True, help_text='Optional reference to a deduction template or master list', null=True)),
                ('effective_from', models.DateField(blank=True, help_text='Date when this deduction takes effect', null=True)),
                ('contract', models.ForeignKey(help_text='Contract this component belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='%(class)ss', to='contracts.contract')),
            ],
            options={
                'verbose_name': 'Deduction',
                'verbose_name_plural': 'Deductions',
                'db_table': 'contract_deductions',
                'ordering': ['name'],
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='SalaryScale',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True, help_text='ID of the employer (from main database)')),
                ('salary_category', models.CharField(help_text='Salary category', max_length=255)),
                ('echelon', models.CharField(help_text='Echelon', max_length=50)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Salary amount', max_digits=12)),
                ('status', models.CharField(choices=[('ENABLED', 'Enabled'), ('DISABLED', 'Disabled')], default='ENABLED', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Salary Scale',
                'verbose_name_plural': 'Salary Scales',
                'db_table': 'salary_scales',
                'ordering': ['salary_category', 'echelon'],
                'indexes': [models.Index(fields=['employer_id', 'status'], name='salary_scale_emp_status_idx'), models.Index(fields=['employer_id', 'salary_category'], name='salary_scale_emp_cat_idx')],
            },
        ),
        migrations.AddField(
            model_name='contract',
            name='salary_scale',
            field=models.ForeignKey(blank=True, help_text='Salary scale for this contract', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contracts', to='contracts.salaryscale'),
        ),
        migrations.CreateModel(
            name='ContractAmendment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amendment_number', models.IntegerField(help_text='Sequential number of the amendment (1, 2, 3...)')),
                ('changed_fields', models.JSONField(default=dict, help_text='JSON Structure of changed fields (e.g., {"base_salary": {"old": 500000, "new": 550000}})')),
                ('effective_date', models.DateField(help_text='Date when this amendment takes effect')),
                ('document', models.FileField(blank=True, help_text='Amendment document (PDF/DOCX)', null=True, upload_to='contract_amendments/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('contract', models.ForeignKey(help_text='Contract being amended', on_delete=django.db.models.deletion.CASCADE, related_name='amendments', to='contracts.contract')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, help_text='User who created the amendment', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contract Amendment',
                'verbose_name_plural': 'Contract Amendments',
                'db_table': 'contract_amendments',
                'ordering': ['amendment_number'],
                'unique_together': {('contract', 'amendment_number')},
            },
        ),
        migrations.CreateModel(
            name='ContractConfiguration',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True, help_text='ID of the employer (from main database)')),
                ('contract_type', models.CharField(blank=True, choices=[('PERMANENT', 'Permanent'), ('FIXED_TERM', 'Fixed-Term'), ('INTERNSHIP', 'Internship'), ('CONSULTANT', 'Consultant'), ('PART_TIME', 'Part-Time')], help_text='Null for global settings, or specific type for overrides', max_length=20, null=True)),
                ('id_prefix', models.CharField(default='CNT', max_length=10)),
                ('id_year_format', models.CharField(choices=[('YYYY', 'YYYY'), ('YY', 'YY')], default='YYYY', max_length=4)),
                ('id_include_institution_code', models.BooleanField(default=False)),
                ('id_sequence_padding', models.IntegerField(default=5)),
                ('id_reset_sequence_yearly', models.BooleanField(default=True)),
                ('last_sequence_number', models.IntegerField(default=0)),
                ('max_backdate_days', models.IntegerField(default=30)),
                ('allow_future_contracts', models.BooleanField(default=True)),
                ('min_fixed_term_duration_days', models.IntegerField(default=30)),
                ('probation_must_end_before_contract', models.BooleanField(default=True)),
                ('default_duration_months', models.IntegerField(blank=True, null=True)),
                ('end_date_required', models.BooleanField(default=True)),
                ('default_probation_period_months', models.IntegerField(default=3)),
                ('overtime_eligible', models.BooleanField(default=True)),
                ('default_notice_period_days', models.IntegerField(default=30)),
                ('default_leave_policy', models.CharField(blank=True, max_length=100, null=True)),
                ('min_wage', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('max_salary_without_approval', models.DecimalField(decimal_places=2, default=1000000, max_digits=12)),
                ('salary_scale_enforcement', models.CharField(choices=[('STRICT', 'Strict'), ('WARNING', 'Warning'), ('DISABLED', 'Disabled')], default='WARNING', max_length=20)),
                ('allow_salary_override', models.BooleanField(default=True)),
                ('require_gross_salary_gt_zero', models.BooleanField(default=True)),
                ('allow_duplicate_allowances', models.BooleanField(default=False)),
                ('auto_apply_default_allowances', models.BooleanField(default=True)),
                ('allow_manual_allowances', models.BooleanField(default=True)),
                ('allow_percentage_allowances', models.BooleanField(default=True)),
                ('max_allowance_percentage', models.DecimalField(decimal_places=2, default=50.0, max_digits=5)),
                ('approval_enabled', models.BooleanField(default=False)),
                ('requires_approval', models.BooleanField(default=False)),
                ('approval_levels', models.JSONField(blank=True, default=list, help_text='List of roles: ["HR", "FINANCE", "CEO"]')),
                ('salary_thresholds', models.JSONField(blank=True, default=dict, help_text='Thresholds per level: {"FINANCE": 500000, "CEO": 1000000}')),
                ('signature_required', models.BooleanField(default=True)),
                ('requires_signature', models.BooleanField(default=True)),
                ('signing_order', models.CharField(choices=[('EMPLOYEE_FIRST', 'Employee -> Employer'), ('EMPLOYER_FIRST', 'Employer -> Employee'), ('PARALLEL', 'Parallel')], default='EMPLOYEE_FIRST', max_length=20)),
                ('allow_activation_without_signature', models.BooleanField(default=False)),
                ('signature_reminder_interval_days', models.IntegerField(default=3)),
                ('signature_expiry_days', models.IntegerField(default=14)),
                ('allow_concurrent_contracts_same_inst', models.BooleanField(default=False)),
                ('allow_multi_institution_employment', models.BooleanField(default=False)),
                ('auto_activate_on_start', models.BooleanField(default=True)),
                ('auto_expire_fixed_term', models.BooleanField(default=True)),
                ('auto_renew_option_available', models.BooleanField(default=False)),
                ('expiry_grace_period_days', models.IntegerField(default=0)),
                ('enable_notifications', models.BooleanField(default=True)),
                ('days_before_expiry_notify', models.IntegerField(default=30)),
                ('recruitment_configuration', models.JSONField(blank=True, default=dict, help_text='Recruitment metadata defaults (application IDs, offer refs, etc.)')),
                ('attendance_configuration', models.JSONField(blank=True, default=dict, help_text='Work rules (schedule type, shift template, attendance requirements)')),
                ('time_off_configuration', models.JSONField(blank=True, default=dict, help_text='Leave policy defaults & overrides per leave type')),
                ('payroll_configuration', models.JSONField(blank=True, default=dict, help_text='Payroll inputs (tax profile, CNPS, probation, proration)')),
                ('expense_configuration', models.JSONField(blank=True, default=dict, help_text='Expense routing (policy, cost center, reimbursement)')),
                ('fleet_configuration', models.JSONField(blank=True, default=dict, help_text='Fleet entitlements (vehicle, transport allowance)')),
                ('treasury_configuration', models.JSONField(blank=True, default=dict, help_text='Treasury preferences (payment priority/channel)')),
                ('signature_configuration', models.JSONField(blank=True, default=dict, help_text='Document & signature defaults (template, method, document hash)')),
                ('governance_configuration', models.JSONField(blank=True, default=dict, help_text='Governance/audit defaults (approval/activation ownership)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('default_template', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='configurations', to='contracts.contracttemplate')),
            ],
            options={
                'verbose_name': 'Contract Configuration',
                'verbose_name_plural': 'Contract Configurations',
                'db_table': 'contract_configurations',
                'unique_together': {('employer_id', 'contract_type')},
            },
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['employer_id', 'status'], name='contracts_employe_e50117_idx'),
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['employee', 'status'], name='contracts_employe_a560a5_idx'),
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['start_date', 'end_date'], name='contracts_start_d_f0a101_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='contract',
            unique_together={('employer_id', 'contract_id')},
        ),
    ]
