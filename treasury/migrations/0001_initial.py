# Generated by Django 5.2.9 on 2026-01-26 09:06

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from decimal import Decimal
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('accounts', '0001_initial'),
        ('employees', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='BankAccount',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True)),
                ('name', models.CharField(max_length=255)),
                ('currency', models.CharField(max_length=10)),
                ('bank_name', models.CharField(max_length=255)),
                ('account_number', models.CharField(blank=True, max_length=64, null=True)),
                ('iban', models.CharField(blank=True, max_length=64, null=True)),
                ('account_holder_name', models.CharField(max_length=255)),
                ('opening_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=20)),
                ('current_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='treasury_bank_accounts', to='employees.branch')),
            ],
            options={
                'db_table': 'treasury_bank_accounts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='BankStatement',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('imported_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('IMPORTED', 'Imported'), ('READY', 'Ready'), ('ARCHIVED', 'Archived')], default='IMPORTED', max_length=20)),
                ('source_file', models.CharField(blank=True, max_length=255, null=True)),
                ('bank_account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='statements', to='treasury.bankaccount')),
            ],
            options={
                'db_table': 'treasury_bank_statements',
                'ordering': ['-period_start'],
            },
        ),
        migrations.CreateModel(
            name='BankStatementLine',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('txn_date', models.DateField()),
                ('description', models.TextField(blank=True)),
                ('amount_signed', models.DecimalField(decimal_places=2, max_digits=20)),
                ('currency', models.CharField(max_length=10)),
                ('reference_raw', models.CharField(blank=True, max_length=128, null=True)),
                ('external_id', models.CharField(blank=True, max_length=128, null=True)),
                ('matched', models.BooleanField(default=False)),
                ('bank_statement', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='treasury.bankstatement')),
            ],
            options={
                'db_table': 'treasury_bank_statement_lines',
                'ordering': ['txn_date'],
            },
        ),
        migrations.CreateModel(
            name='CashDesk',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True)),
                ('name', models.CharField(max_length=255)),
                ('currency', models.CharField(max_length=10)),
                ('opening_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=20)),
                ('current_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='treasury_cash_desks', to='employees.branch')),
                ('custodian_employee', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='custodied_cash_desks', to='employees.employee')),
            ],
            options={
                'db_table': 'treasury_cash_desks',
                'ordering': ['branch', 'name'],
            },
        ),
        migrations.CreateModel(
            name='CashDeskSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('opened_by_id', models.IntegerField()),
                ('opened_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('opening_count_amount', models.DecimalField(decimal_places=2, max_digits=20)),
                ('status', models.CharField(choices=[('OPEN', 'Open'), ('CLOSED', 'Closed')], default='OPEN', max_length=10)),
                ('closed_by_id', models.IntegerField(blank=True, null=True)),
                ('closed_at', models.DateTimeField(blank=True, null=True)),
                ('closing_count_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=20, null=True)),
                ('discrepancy_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=20, null=True)),
                ('discrepancy_note', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('cashdesk', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sessions', to='treasury.cashdesk')),
            ],
            options={
                'db_table': 'treasury_cashdesk_sessions',
                'ordering': ['-opened_at'],
            },
        ),
        migrations.CreateModel(
            name='PaymentBatch',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True)),
                ('name', models.CharField(max_length=255)),
                ('source_type', models.CharField(choices=[('BANK', 'Bank Account'), ('CASHDESK', 'Cash Desk')], max_length=20)),
                ('source_id', models.UUIDField()),
                ('payment_method', models.CharField(choices=[('BANK_TRANSFER', 'Bank Transfer'), ('CASH', 'Cash'), ('MOBILE_MONEY', 'Mobile Money'), ('CHEQUE', 'Cheque')], max_length=20)),
                ('planned_date', models.DateField()),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('APPROVAL_PENDING', 'Approval Pending'), ('APPROVED', 'Approved'), ('EXECUTED', 'Executed'), ('PARTIALLY_RECONCILED', 'Partially Reconciled'), ('RECONCILED', 'Reconciled'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=20)),
                ('total_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=20)),
                ('currency', models.CharField(max_length=10)),
                ('created_by_id', models.IntegerField(blank=True, null=True)),
                ('approved_by_id', models.IntegerField(blank=True, null=True)),
                ('executed_by_id', models.IntegerField(blank=True, null=True)),
                ('executed_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('reference_number', models.CharField(blank=True, max_length=64, null=True)),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='treasury_payment_batches', to='employees.branch')),
            ],
            options={
                'db_table': 'treasury_payment_batches',
                'ordering': ['-planned_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PaymentLine',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('payee_type', models.CharField(choices=[('EMPLOYEE', 'Employee'), ('VENDOR', 'Vendor'), ('OTHER', 'Other')], max_length=20)),
                ('payee_id', models.UUIDField(blank=True, null=True)),
                ('payee_name', models.CharField(max_length=255)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=20)),
                ('currency', models.CharField(max_length=10)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('PAID', 'Paid'), ('FAILED', 'Failed'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=20)),
                ('external_reference', models.CharField(blank=True, max_length=128, null=True)),
                ('linked_object_type', models.CharField(choices=[('PAYSLIP', 'Payslip'), ('EXPENSE_CLAIM', 'Expense Claim'), ('BILL', 'Bill'), ('NONE', 'None')], default='NONE', max_length=20)),
                ('linked_object_id', models.UUIDField(blank=True, null=True)),
                ('requires_approval', models.BooleanField(default=False)),
                ('approved', models.BooleanField(default=False)),
                ('approved_by_id', models.IntegerField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('batch', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='treasury.paymentbatch')),
            ],
            options={
                'db_table': 'treasury_payment_lines',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ReconciliationMatch',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('match_type', models.CharField(choices=[('PAYMENT_LINE', 'Payment Line'), ('TREASURY_TRANSACTION', 'Treasury Transaction')], max_length=30)),
                ('match_id', models.UUIDField()),
                ('confidence', models.PositiveSmallIntegerField(default=0)),
                ('status', models.CharField(choices=[('SUGGESTED', 'Suggested'), ('CONFIRMED', 'Confirmed'), ('REJECTED', 'Rejected')], default='SUGGESTED', max_length=20)),
                ('confirmed_by_id', models.IntegerField(blank=True, null=True)),
                ('confirmed_at', models.DateTimeField(blank=True, null=True)),
                ('rejected_reason', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('statement_line', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='matches', to='treasury.bankstatementline')),
            ],
            options={
                'db_table': 'treasury_reconciliation_matches',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TreasuryTransaction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('employer_id', models.IntegerField(db_index=True)),
                ('source_type', models.CharField(choices=[('BANK', 'Bank Account'), ('CASHDESK', 'Cash Desk')], max_length=20)),
                ('source_id', models.UUIDField()),
                ('direction', models.CharField(choices=[('IN', 'Money In'), ('OUT', 'Money Out')], max_length=10)),
                ('category', models.CharField(choices=[('SALARY', 'Salary'), ('EXPENSE', 'Expense'), ('VENDOR', 'Vendor'), ('TRANSFER', 'Transfer'), ('WITHDRAWAL', 'Withdrawal'), ('DEPOSIT', 'Deposit'), ('ADJUSTMENT', 'Adjustment'), ('OTHER', 'Other')], default='OTHER', max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=20)),
                ('currency', models.CharField(max_length=10)),
                ('transaction_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('reference', models.CharField(max_length=64, unique=True)),
                ('counterparty_name', models.CharField(blank=True, max_length=255)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('APPROVAL_PENDING', 'Approval Pending'), ('APPROVED', 'Approved'), ('POSTED', 'Posted'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=20)),
                ('created_by_id', models.IntegerField(blank=True, null=True)),
                ('approved_by_id', models.IntegerField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('linked_object_type', models.CharField(choices=[('PAYMENT_LINE', 'Payment Line'), ('PAY_RUN', 'Pay Run'), ('EXPENSE', 'Expense'), ('BILL', 'Bill'), ('MANUAL', 'Manual'), ('NONE', 'None')], default='NONE', max_length=20)),
                ('linked_object_id', models.UUIDField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('cashdesk_session', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='treasury.cashdesksession')),
            ],
            options={
                'db_table': 'treasury_transactions',
                'ordering': ['-transaction_date'],
            },
        ),
        migrations.CreateModel(
            name='TreasuryConfiguration',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('default_currency', models.CharField(default='XAF', max_length=3)),
                ('enable_bank_accounts', models.BooleanField(default=True)),
                ('enable_cash_desks', models.BooleanField(default=True)),
                ('enable_mobile_money', models.BooleanField(default=False)),
                ('enable_cheques', models.BooleanField(default=False)),
                ('enable_reconciliation', models.BooleanField(default=True)),
                ('batch_reference_format', models.CharField(default='PAY-{YYYY}{MM}-{SEQ}', max_length=100)),
                ('transaction_reference_format', models.CharField(default='TRX-{YYYY}{MM}-{SEQ}', max_length=100)),
                ('cash_voucher_format', models.CharField(default='CV-{BRANCH}-{SEQ}', max_length=100)),
                ('sequence_reset_policy', models.CharField(choices=[('MONTHLY', 'Monthly'), ('YEARLY', 'Yearly'), ('NEVER', 'Never')], default='NEVER', max_length=10)),
                ('batch_approval_required', models.BooleanField(default=True)),
                ('batch_approval_threshold_amount', models.DecimalField(decimal_places=2, default=Decimal('1000000.00'), max_digits=20, validators=[django.core.validators.MinValueValidator(0)])),
                ('dual_approval_required_for_payroll', models.BooleanField(default=True)),
                ('allow_self_approval', models.BooleanField(default=False)),
                ('cancellation_requires_approval', models.BooleanField(default=True)),
                ('line_approval_required', models.BooleanField(default=False)),
                ('line_approval_threshold_amount', models.DecimalField(decimal_places=2, default=Decimal('500000.00'), max_digits=20, validators=[django.core.validators.MinValueValidator(0)])),
                ('allow_edit_after_approval', models.BooleanField(default=False)),
                ('default_salary_payment_method', models.CharField(choices=[('BANK_TRANSFER', 'Bank Transfer'), ('CASH', 'Cash'), ('MOBILE_MONEY', 'Mobile Money'), ('CHEQUE', 'Cheque')], default='BANK_TRANSFER', max_length=30)),
                ('default_expense_payment_method', models.CharField(choices=[('BANK_TRANSFER', 'Bank Transfer'), ('CASH', 'Cash'), ('MOBILE_MONEY', 'Mobile Money'), ('CHEQUE', 'Cheque')], default='CASH', max_length=30)),
                ('default_vendor_payment_method', models.CharField(choices=[('BANK_TRANSFER', 'Bank Transfer'), ('CASH', 'Cash'), ('MOBILE_MONEY', 'Mobile Money'), ('CHEQUE', 'Cheque')], default='BANK_TRANSFER', max_length=30)),
                ('require_beneficiary_details_for_non_cash', models.BooleanField(default=True)),
                ('execution_proof_required', models.BooleanField(default=False)),
                ('enable_csv_export', models.BooleanField(default=True)),
                ('enable_iso20022_export', models.BooleanField(default=False)),
                ('csv_template_code', models.CharField(blank=True, max_length=30, null=True)),
                ('require_open_session', models.BooleanField(default=True)),
                ('allow_negative_cash_balance', models.BooleanField(default=False)),
                ('max_cash_desk_balance', models.DecimalField(decimal_places=2, default=Decimal('10000000.00'), max_digits=20, validators=[django.core.validators.MinValueValidator(0)])),
                ('min_balance_alert', models.DecimalField(decimal_places=2, default=Decimal('1000.00'), max_digits=20, validators=[django.core.validators.MinValueValidator(0)])),
                ('cash_out_approval_threshold', models.DecimalField(decimal_places=2, default=Decimal('500000.00'), max_digits=20, validators=[django.core.validators.MinValueValidator(0)])),
                ('cash_out_requires_reason', models.BooleanField(default=True)),
                ('adjustments_require_approval', models.BooleanField(default=True)),
                ('discrepancy_tolerance_amount', models.DecimalField(decimal_places=2, default=Decimal('2000.00'), max_digits=20, validators=[django.core.validators.MinValueValidator(0)])),
                ('auto_lock_cash_desk_on_discrepancy', models.BooleanField(default=False)),
                ('auto_match_enabled', models.BooleanField(default=True)),
                ('match_window_days', models.IntegerField(default=7, validators=[django.core.validators.MinValueValidator(0)])),
                ('auto_confirm_confidence_threshold', models.IntegerField(default=95, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('matching_strictness', models.CharField(choices=[('LOOSE', 'Loose'), ('BALANCED', 'Balanced'), ('STRICT', 'Strict')], default='BALANCED', max_length=10)),
                ('lock_batch_until_reconciled', models.BooleanField(default=False)),
                ('institution', models.ForeignKey(blank=True, db_constraint=False, help_text='Institution owning this configuration (nullable for single-tenant setups).', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='treasury_configurations', to='accounts.employerprofile')),
            ],
            options={
                'verbose_name': 'Treasury Configuration',
                'verbose_name_plural': 'Treasury Configuration',
                'db_table': 'treasury_configuration',
                'constraints': [models.UniqueConstraint(condition=models.Q(('institution__isnull', False), ('is_active', True)), fields=('institution',), name='uniq_treasury_config_active_institution')],
            },
        ),
    ]
